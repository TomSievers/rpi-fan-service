name: Rust

on:
  release:
    types: [published]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Setup
      run: rustup target add arm-unknown-linux-gnueabihf
    - name: Get version
      id: get_version
      run: |
        echo ::set-output name=VERSION::${GITHUB_REF/refs\/tags\//}
      shell: bash
    - name: Set version
      run: sed -i -E "1,/version/ s/version.+/version = \"${{ steps.get_version.outputs.VERSION }}\"/g" Cargo.toml
      shell: bash
    - name: Build
      run: ./create-deb
      shell: bash